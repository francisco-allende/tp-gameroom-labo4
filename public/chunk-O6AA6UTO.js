import{a as B,c as H,e as q,j as L,k as R}from"./chunk-QDQ35NV5.js";import{a as z,b as W}from"./chunk-AA5YUFBJ.js";import"./chunk-5CCLXYTQ.js";import{c as T,s as U,u as N,v as $,w as g,x as A}from"./chunk-YX3NCP3F.js";import{$a as y,Ab as D,Bb as I,Db as F,Na as s,Oa as v,V as M,_,cb as w,da as S,e as f,gb as O,hb as j,ib as P,jb as k,kb as i,lb as a,mb as h,sb as b,tb as p,wb as m,x,xb as u,yb as C,zb as E}from"./chunk-MZUU66T2.js";var V=(()=>{let o=class o{constructor(e){this.firestore=e}addMsjToSalaChat(e,t){return f(this,null,function*(){try{let n=g(this.firestore,"sala-chat");$(n,{sender:e,content:t,fecha:new Date})}catch(n){console.error("Error en el add a los msjs:",n)}})}getAllMensajesSalaChats(){return f(this,null,function*(){let e=g(this.firestore,"sala-chat");try{let t=yield A(e),n=[];return t.forEach(l=>{n.push(l.data())}),n}catch(t){throw console.error("Error obteniendo los mensajes:",t),t}})}getAllMensajesSalaChat(){let e=g(this.firestore,"sala-chat");return N(e).pipe(x(t=>t.sort((n,l)=>n.fecha.toDate()-l.fecha.toDate())))}};o.\u0275fac=function(t){return new(t||o)(_(U))},o.\u0275prov=M({token:o,factory:o.\u0275fac,providedIn:"root"});let r=o;return r})();function Q(r,o){if(r&1&&(i(0,"li",9),m(1),i(2,"span",10),m(3),a(),h(4,"span",11),a()),r&2){let c=p().$implicit,e=p();s(),C(" ",c.content," "),s(2),u(e.formatDate(c.fecha))}}function X(r,o){if(r&1&&(i(0,"li",12)(1,"h6"),m(2),a(),m(3),i(4,"span",10),m(5),a(),h(6,"span",11),a()),r&2){let c=p().$implicit,e=p();s(2),u(e.setChatNickName(c.sender.email)),s(),C(" ",c.content," "),s(2),u(e.formatDate(c.fecha))}}function Z(r,o){if(r&1&&y(0,Q,5,2,"li",9)(1,X,7,3),r&2){let c=o.$implicit,e=p();O(0,e.itsMe(c)?0:1)}}var le=(()=>{let o=class o{constructor(e){this.chatService=e,this.newMessage="",this.messages=[],this.itsMe=t=>t.sender.email==this.currentUser.email}ngOnInit(){this.chatService.getAllMensajesSalaChat().subscribe(e=>{this.messages=e})}sendMessage(){this.chatService.addMsjToSalaChat(this.currentUser,this.newMessage),this.newMessage=""}formatDate(e){let t=e.toDate(),n=("0"+t.getDate()).slice(-2),l=("0"+(t.getMonth()+1)).slice(-2),d=t.getFullYear(),Y=("0"+t.getHours()).slice(-2),G=("0"+t.getMinutes()).slice(-2);return`${n}/${l}/${d} ${Y}:${G}`}setChatNickName(e){let t=e.indexOf("@");return t!==-1?e.substring(0,t):e}handleSetUser(e){this.currentUser=e}};o.\u0275fac=function(t){return new(t||o)(v(V))},o.\u0275cmp=S({type:o,selectors:[["app-sala-chat"]],inputs:{currentUser:"currentUser"},standalone:!0,features:[F],decls:15,vars:2,consts:[[3,"sendCurrentUser"],[1,"main"],[1,"container","text-center","justify-content-center","align-items-center"],[1,"title"],[1,"container","screen"],[1,"list-group"],[1,"input-group","mt-3"],["type","text","placeholder","Escribe tu mensaje...",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click","disabled"],[1,"list-group-item","text-start","chat-bubble-me"],[1,"chat-date"],[1,"chat-bubble-triangle"],[1,"list-group-item","text-end","chat-bubble-other"]],template:function(t,n){t&1&&(i(0,"app-header",0),b("sendCurrentUser",function(d){return n.handleSetUser(d)}),a(),i(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1"),m(5,"Sala de chat"),a()(),i(6,"div",4)(7,"ul",5),P(8,Z,2,1,null,null,j),a()(),i(10,"div",6)(11,"input",7),I("ngModelChange",function(d){return D(n.newMessage,d)||(n.newMessage=d),d}),a(),i(12,"button",8),b("click",function(){return n.sendMessage()}),m(13,"Enviar"),a()()()(),h(14,"app-footer")),t&2&&(s(8),k(n.messages),s(3),E("ngModel",n.newMessage),s(),w("disabled",!n.newMessage.trim()))},dependencies:[z,W,L,B,H,q,R,T],styles:['.main[_ngcontent-%COMP%]{height:100vh;background-color:#91e4f1}.screen[_ngcontent-%COMP%]{padding-top:1em;padding-bottom:1em;background-color:#dcf8c6;border-radius:.4em}.title[_ngcontent-%COMP%]{padding:1em}.list-group[_ngcontent-%COMP%]{max-height:700px;overflow-y:auto}.chat-bubble-me[_ngcontent-%COMP%], .chat-bubble-other[_ngcontent-%COMP%]{border-radius:.4em;padding:10px;margin:10px 15px 0;position:relative;color:#fff}.chat-bubble-me[_ngcontent-%COMP%]{border:2px solid #128c7e;background-color:#128c7e}.chat-bubble-other[_ngcontent-%COMP%]{border:2px solid #075e54;background-color:#075e54}.chat-bubble-me[_ngcontent-%COMP%]:after, .chat-bubble-other[_ngcontent-%COMP%]:after{content:"";position:absolute;top:10%;width:0;height:0;border:14px solid transparent;border-top:0;margin-top:-7px}.chat-bubble-me[_ngcontent-%COMP%]:after{left:0;border-left:0;border-right-color:#128c7e;margin-left:-14px}.chat-bubble-other[_ngcontent-%COMP%]:after{right:0;border-left-color:#075e54;border-right:0;margin-right:-14px}.message[_ngcontent-%COMP%]{display:block;font-size:16px;color:#000}.timestamp[_ngcontent-%COMP%]{position:absolute;bottom:0;right:10px;font-size:12px;color:#666}.chat-date[_ngcontent-%COMP%]{font-size:12px;color:#b5b4b4;display:block;margin-top:5px}@media (max-width: 1300px){.list-group[_ngcontent-%COMP%]{max-height:320px}}']});let r=o;return r})();export{le as SalaChatComponent};
